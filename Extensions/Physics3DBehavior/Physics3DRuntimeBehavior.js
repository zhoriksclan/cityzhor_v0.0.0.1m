var gdjs;(function(n){const _=async()=>{try{const t=(await import("./jolt-physics.wasm.js")).default;if(!t)throw new Error("No default export found in Jolt.");const e=await t();window.Jolt=e}catch(f){throw console.error("Unable to load Jolt physics library.",f),f}};n.registerAsynchronouslyLoadingLibraryPromise(_());class u{constructor(t,e){this._tempVec3=new Jolt.Vec3;this._tempRVec3=new Jolt.RVec3;this._tempQuat=new Jolt.Quat;this.stepped=!1;this._physics3DHooks=[];this._registeredBehaviors=new Set,this.gravityX=e.gravityX,this.gravityY=e.gravityY,this.gravityZ=e.gravityZ,this.worldScale=e.worldScale,this.worldInvScale=1/this.worldScale;const s=new Jolt.JoltSettings;n.Physics3DSharedData.setupCollisionFiltering(s),this.jolt=new Jolt.JoltInterface(s),Jolt.destroy(s),this.physicsSystem=this.jolt.GetPhysicsSystem(),this.physicsSystem.SetGravity(this.getVec3(this.gravityX,this.gravityY,this.gravityZ)),this.bodyInterface=this.physicsSystem.GetBodyInterface(),this.contactListener=new Jolt.ContactListenerJS,this.physicsSystem.SetContactListener(this.contactListener),this.contactListener.OnContactAdded=(i,o,a,r)=>{const d=Jolt.wrapPointer(i,Jolt.Body),c=Jolt.wrapPointer(o,Jolt.Body),l=d.gdjsAssociatedBehavior,h=c.gdjsAssociatedBehavior;!l||!h||(l.onContactBegin(h),h.onContactBegin(l))},this.contactListener.OnContactRemoved=i=>{const o=Jolt.wrapPointer(i,Jolt.SubShapeIDPair),a=this.physicsSystem.GetBodyLockInterface(),r=a.TryGetBody(o.GetBody1ID()),d=a.TryGetBody(o.GetBody2ID()),c=r.gdjsAssociatedBehavior,l=d.gdjsAssociatedBehavior;!c||!l||(c.onContactEnd(l),l.onContactEnd(c))},this.contactListener.OnContactPersisted=(i,o,a,r)=>{},this.contactListener.OnContactValidate=(i,o,a,r)=>Jolt.ValidateResult_AcceptAllContactsForThisBodyPair}getVec3(t,e,s){const i=this._tempVec3;return i.Set(t,e,s),i}getRVec3(t,e,s){const i=this._tempRVec3;return i.Set(t,e,s),i}getQuat(t,e,s,i){const o=this._tempQuat;return o.Set(t,e,s,i),o}static getSharedData(t,e){if(!t.physics3DSharedData){const s=t.getInitialSharedDataForBehavior(e);t.physics3DSharedData=new n.Physics3DSharedData(t,s)}return t.physics3DSharedData}static setupCollisionFiltering(t){const e=new Jolt.ObjectLayerPairFilterMask,s=new Jolt.BroadPhaseLayer(n.Physics3DSharedData.staticBroadPhaseLayerIndex),i=new Jolt.BroadPhaseLayer(n.Physics3DSharedData.dynamicBroadPhaseLayerIndex),o=new Jolt.BroadPhaseLayerInterfaceMask(2);o.ConfigureLayer(s,n.Physics3DSharedData.staticLayersMask,0),o.ConfigureLayer(i,n.Physics3DSharedData.dynamicLayersMask,0),Jolt.destroy(s),Jolt.destroy(i),t.mObjectLayerPairFilter=e,t.mBroadPhaseLayerInterface=o,t.mObjectVsBroadPhaseLayerFilter=new Jolt.ObjectVsBroadPhaseLayerFilterMask(o)}addToBehaviorsList(t){this._registeredBehaviors.add(t)}removeFromBehaviorsList(t){this._registeredBehaviors.delete(t)}step(t){for(const s of this._registeredBehaviors)s._contactsStartedThisFrame.length=0,s._contactsEndedThisFrame.length=0;for(const s of this._registeredBehaviors)s.updateBodyFromObject();for(const s of this._physics3DHooks)s.doBeforePhysicsStep(t);const e=t>1/55?2:1;this.jolt.Step(t,e),this.stepped=!0;for(const s of this._registeredBehaviors)s.updateObjectFromBody()}registerHook(t){this._physics3DHooks.push(t)}}u.staticLayersMask=15,u.dynamicLayersMask=240,u.allLayersMask=255,u.staticBroadPhaseLayerIndex=1,u.dynamicBroadPhaseLayerIndex=1,n.Physics3DSharedData=u,n.registerRuntimeSceneUnloadedCallback(function(f){const t=f.physics3DSharedData;t&&(Jolt.destroy(t.contactListener),Jolt.destroy(t._tempVec3),Jolt.destroy(t._tempRVec3),Jolt.destroy(t._tempQuat),Jolt.destroy(t.jolt),f.physics3DSharedData=null)});class g extends n.RuntimeBehavior{constructor(t,e,s){super(t,e,s);this.shapeScale=1;this._contactsStartedThisFrame=[];this._contactsEndedThisFrame=[];this._currentContacts=[];this._destroyedDuringFrameLogic=!1;this._body=null;this._needToRecreateBody=!1;this._needToRecreateShape=!1;this._shapeHalfWidth=0;this._shapeHalfHeight=0;this._shapeHalfDepth=0;this._objectOldX=0;this._objectOldY=0;this._objectOldZ=0;this._objectOldRotationX=0;this._objectOldRotationY=0;this._objectOldRotationZ=0;this._objectOldWidth=0;this._objectOldHeight=0;this._objectOldDepth=0;this.bodyUpdater=new n.Physics3DRuntimeBehavior.DefaultBodyUpdater(this),this.collisionChecker=new n.Physics3DRuntimeBehavior.DefaultCollisionChecker(this),this.owner3D=s,this.bodyType=e.bodyType,this.bullet=e.bullet,this.fixedRotation=e.fixedRotation,this.shape=e.shape,this.shapeOrientation=e.shape==="Box"?"Z":e.shapeOrientation,this.shapeDimensionA=e.shapeDimensionA,this.shapeDimensionB=e.shapeDimensionB,this.shapeDimensionC=e.shapeDimensionC,this.shapeOffsetX=e.shapeOffsetX||0,this.shapeOffsetY=e.shapeOffsetY||0,this.shapeOffsetZ=e.shapeOffsetZ||0,this.massCenterOffsetX=e.massCenterOffsetX||0,this.massCenterOffsetY=e.massCenterOffsetY||0,this.massCenterOffsetZ=e.massCenterOffsetZ||0,this.density=e.density,this.massOverride=e.massOverride||0,this.friction=e.friction,this.restitution=e.restitution,this.linearDamping=Math.max(0,e.linearDamping),this.angularDamping=Math.max(0,e.angularDamping),this.gravityScale=e.gravityScale,this.layers=e.layers,this.masks=e.masks,this._sharedData=u.getSharedData(t.getScene(),e.name),this._sharedData.addToBehaviorsList(this)}getVec3(t,e,s){const i=this._sharedData._tempVec3;return i.Set(t,e,s),i}getRVec3(t,e,s){const i=this._sharedData._tempRVec3;return i.Set(t,e,s),i}getQuat(t,e,s,i){const o=this._sharedData._tempQuat;return o.Set(t,e,s,i),o}updateFromBehaviorData(t,e){return t.bullet!==e.bullet&&this.setBullet(e.bullet),t.fixedRotation!==e.fixedRotation&&this.setFixedRotation(e.fixedRotation),t.shapeDimensionA!==e.shapeDimensionA&&(this.shapeDimensionA=e.shapeDimensionA,this._needToRecreateShape=!0),t.shapeDimensionB!==e.shapeDimensionB&&(this.shapeDimensionB=e.shapeDimensionB,this._needToRecreateShape=!0),t.density!==e.density&&this.setDensity(e.density),t.friction!==e.friction&&this.setFriction(e.friction),t.restitution!==e.restitution&&this.setRestitution(e.restitution),t.linearDamping!==e.linearDamping&&this.setLinearDamping(e.linearDamping),t.angularDamping!==e.angularDamping&&this.setAngularDamping(e.angularDamping),t.gravityScale!==e.gravityScale&&this.setGravityScale(e.gravityScale),!(t.layers!==e.layers||t.masks!==e.masks||t.vertices!==e.vertices||t.bodyType!==e.bodyType||t.shape!==e.shape)}getNetworkSyncData(){let t;if(this._body){const e=this._body.GetPosition(),s=this._body.GetRotation(),i=this._body.GetLinearVelocity(),o=this._body.GetAngularVelocity();t={px:e.GetX(),py:e.GetY(),pz:e.GetZ(),rx:s.GetX(),ry:s.GetY(),rz:s.GetZ(),rw:s.GetW(),lvx:i.GetX(),lvy:i.GetY(),lvz:i.GetZ(),avx:o.GetX(),avy:o.GetY(),avz:o.GetZ(),aw:this._body.IsActive()}}else t={px:void 0,py:void 0,pz:void 0,rx:void 0,ry:void 0,rz:void 0,rw:void 0,lvx:void 0,lvy:void 0,lvz:void 0,avx:void 0,avy:void 0,avz:void 0,aw:void 0};return{...super.getNetworkSyncData(),props:{...t,layers:this.layers,masks:this.masks}}}updateFromNetworkSyncData(t){super.updateFromNetworkSyncData(t);const e=t.props;e.px!==void 0&&e.py!==void 0&&e.pz!==void 0&&this._body&&this._sharedData.bodyInterface.SetPosition(this._body.GetID(),this.getRVec3(e.px,e.py,e.pz),Jolt.EActivation_DontActivate),e.rx!==void 0&&e.ry!==void 0&&e.rz!==void 0&&e.rw!==void 0&&this._body&&this._sharedData.bodyInterface.SetRotation(this._body.GetID(),this.getQuat(e.rx,e.ry,e.rz,e.rw),Jolt.EActivation_DontActivate),e.lvx!==void 0&&e.lvy!==void 0&&e.lvz!==void 0&&this._body&&this._sharedData.bodyInterface.SetLinearVelocity(this._body.GetID(),this.getVec3(e.lvx,e.lvy,e.lvz)),e.avx!==void 0&&e.avy!==void 0&&e.avz!==void 0&&this._body&&this._sharedData.bodyInterface.SetAngularVelocity(this._body.GetID(),this.getVec3(e.avx,e.avy,e.avz)),e.layers!==void 0&&(this.layers=e.layers),e.masks!==void 0&&(this.masks=e.masks)}onDeActivate(){this._sharedData.removeFromBehaviorsList(this),this._destroyBody()}onActivate(){this._sharedData.addToBehaviorsList(this)}onDestroy(){this._destroyedDuringFrameLogic=!0,this.onDeActivate()}_destroyBody(){this.bodyUpdater.destroyBody(),this._contactsEndedThisFrame.length=0,this._contactsStartedThisFrame.length=0,this._currentContacts.length=0}resetToDefaultBodyUpdater(){this.bodyUpdater=new n.Physics3DRuntimeBehavior.DefaultBodyUpdater(this)}resetToDefaultCollisionChecker(){this.collisionChecker=new n.Physics3DRuntimeBehavior.DefaultCollisionChecker(this)}createShape(){if(this.massCenterOffsetX===0&&this.massCenterOffsetY===0&&this.massCenterOffsetZ===0)return this.createShapeWithoutMassCenterOffset();const t=this._createNewShapeSettingsWithoutMassCenterOffset(),e=this.shapeScale*this._sharedData.worldInvScale,s=new Jolt.OffsetCenterOfMassShapeSettings(this.getVec3(this.massCenterOffsetX*e,this.massCenterOffsetY*e,this.massCenterOffsetZ*e),t),i=s.Create().Get();return Jolt.destroy(s),i}createShapeWithoutMassCenterOffset(){const t=this._createNewShapeSettingsWithoutMassCenterOffset(),e=t.Create().Get();return Jolt.destroy(t),e}_createNewShapeSettingsWithoutMassCenterOffset(){let t=this.owner3D.getWidth()*this._sharedData.worldInvScale,e=this.owner3D.getHeight()*this._sharedData.worldInvScale,s=this.owner3D.getDepth()*this._sharedData.worldInvScale;if(this.shapeOrientation==="X"){const h=s;s=t,t=h}else if(this.shapeOrientation==="Y"){const h=s;s=e,e=h}const i=this.shapeScale*this._sharedData.worldInvScale,o=this.shapeDimensionA*i,a=this.shapeDimensionB*i,r=this.shapeDimensionC*i,d=this._sharedData.worldInvScale;let c,l;if(this.shape==="Box"){const h=o>0?o:t>0?t:d,y=a>0?a:e>0?e:d,p=r>0?r:s>0?s:d,b=Math.min(d,Math.min(h,y,p)/4);c=new Jolt.BoxShapeSettings(this.getVec3(h/2,y/2,p/2),b),l=this.getQuat(0,0,0,1),this._shapeHalfWidth=h/2,this._shapeHalfHeight=y/2,this._shapeHalfDepth=p/2}else if(this.shape==="Capsule"){const h=o>0?o:t>0?Math.sqrt(t*e)/2:d,y=a>0?a:s>0?s:d;c=new Jolt.CapsuleShapeSettings(Math.max(0,y/2-h),h),l=this._getShapeOrientationQuat(),this._shapeHalfWidth=this.shapeOrientation==="X"?y/2:h,this._shapeHalfHeight=this.shapeOrientation==="Y"?y/2:h,this._shapeHalfDepth=this.shapeOrientation==="Z"?y/2:h}else if(this.shape==="Cylinder"){const h=o>0?o:t>0?Math.sqrt(t*e)/2:d,y=a>0?a:s>0?s:d,p=Math.min(d,Math.min(y,h)/4);c=new Jolt.CylinderShapeSettings(y/2,h,p),l=this._getShapeOrientationQuat(),this._shapeHalfWidth=this.shapeOrientation==="X"?y/2:h,this._shapeHalfHeight=this.shapeOrientation==="Y"?y/2:h,this._shapeHalfDepth=this.shapeOrientation==="Z"?y/2:h}else{const h=o>0?o:t>0?Math.pow(t*e*s,1/3)/2:d;c=new Jolt.SphereShapeSettings(h),l=this.getQuat(0,0,0,1),this._shapeHalfWidth=h,this._shapeHalfHeight=h,this._shapeHalfDepth=h}return c.mDensity=this.density,new Jolt.RotatedTranslatedShapeSettings(this.getVec3(this.shapeOffsetX*i,this.shapeOffsetY*i,this.shapeOffsetZ*i),l,c)}_getShapeOrientationQuat(){return this.shapeOrientation==="X"?this.getQuat(0,0,Math.sqrt(2)/2,-Math.sqrt(2)/2):this.shapeOrientation==="Y"?this.getQuat(0,0,0,1):this.getQuat(Math.sqrt(2)/2,0,0,Math.sqrt(2)/2)}_recreateShape(){this.bodyUpdater.recreateShape(),this._objectOldWidth=this.owner3D.getWidth(),this._objectOldHeight=this.owner3D.getHeight(),this._objectOldDepth=this.owner3D.getDepth()}getShapeScale(){return this.shapeScale}setShapeScale(t){t!==this.shapeScale&&t>0&&(this.shapeScale=t,this._needToRecreateShape=!0)}getBody(){return this._body===null&&this._createBody(),this._body}_createBody(){return this._needToRecreateBody=!1,this._needToRecreateShape=!1,!this.activated()||this._destroyedDuringFrameLogic||(this._body=this.bodyUpdater.createAndAddBody(),!this._body)?!1:(this._body.gdjsAssociatedBehavior=this,this._objectOldWidth=this.owner3D.getWidth(),this._objectOldHeight=this.owner3D.getHeight(),this._objectOldDepth=this.owner3D.getDepth(),!0)}getBodyLayer(){return Jolt.ObjectLayerPairFilterMask.prototype.sGetObjectLayer(this.getLayersAccordingToBodyType(),this.getMasksAccordingToBodyType())}getLayersAccordingToBodyType(){return this.isStatic()?this.layers&n.Physics3DSharedData.staticLayersMask:this.layers&n.Physics3DSharedData.dynamicLayersMask}getMasksAccordingToBodyType(){return this.isStatic()?n.Physics3DSharedData.allLayersMask:this.masks}doStepPreEvents(t){!this._sharedData.stepped&&!t.getScene().getTimeManager().isFirstFrame()&&this._sharedData.step(t.getScene().getTimeManager().getElapsedTime()/1e3)}doStepPostEvents(t){this._sharedData.stepped=!1}onObjectHotReloaded(){this.updateBodyFromObject()}recreateBody(){if(!this._body){this._createBody();return}const t=this._sharedData.bodyInterface,e=this._body.GetLinearVelocity(),s=e.GetX(),i=e.GetY(),o=e.GetZ(),a=this._body.GetAngularVelocity(),r=a.GetX(),d=a.GetY(),c=a.GetZ();if(this.bodyUpdater.destroyBody(),this._contactsEndedThisFrame.length=0,this._contactsStartedThisFrame.length=0,this._currentContacts.length=0,this._createBody(),!this._body)return;const l=this._body.GetID();t.SetLinearVelocity(l,this.getVec3(s,i,o)),t.SetAngularVelocity(l,this.getVec3(r,d,c))}updateObjectFromBody(){this.bodyUpdater.updateObjectFromBody(),this._objectOldX=this.owner3D.getX(),this._objectOldY=this.owner3D.getY(),this._objectOldZ=this.owner3D.getZ(),this._objectOldRotationX=this.owner3D.getRotationX(),this._objectOldRotationY=this.owner3D.getRotationY(),this._objectOldRotationZ=this.owner3D.getAngle()}updateBodyFromObject(){this._body===null&&!this._createBody()||(this._needToRecreateBody&&this.recreateBody(),(this._needToRecreateShape||!this.hasCustomShapeDimension()&&(this._objectOldWidth!==this.owner3D.getWidth()||this._objectOldHeight!==this.owner3D.getHeight()||this._objectOldDepth!==this.owner3D.getDepth()))&&(this._needToRecreateShape=!1,this._recreateShape()),this.bodyUpdater.updateBodyFromObject())}hasCustomShapeDimension(){return this.shapeDimensionA>0||this.shapeDimensionB>0||this.shapeDimensionC>0}_getPhysicsPosition(t){return t.Set(this.owner3D.getCenterXInScene()*this._sharedData.worldInvScale,this.owner3D.getCenterYInScene()*this._sharedData.worldInvScale,this.owner3D.getCenterZInScene()*this._sharedData.worldInvScale),t}_getPhysicsRotation(t){const e=this.owner3D.get3DRendererObject();return t.Set(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w),t}_moveObjectToPhysicsPosition(t){this.owner3D.setCenterXInScene(t.GetX()*this._sharedData.worldScale),this.owner3D.setCenterYInScene(t.GetY()*this._sharedData.worldScale),this.owner3D.setCenterZInScene(t.GetZ()*this._sharedData.worldScale)}_moveObjectToPhysicsRotation(t){const e=this.owner3D.get3DRendererObject();e.quaternion.x=t.GetX(),e.quaternion.y=t.GetY(),e.quaternion.z=t.GetZ(),e.quaternion.w=t.GetW();const s=new THREE.Euler(0,0,0,"ZYX");s.setFromQuaternion(e.quaternion),this.owner3D.setRotationX(n.toDegrees(s.x)),this.owner3D.setRotationY(n.toDegrees(s.y)),this.owner3D.setAngle(n.toDegrees(s.z))}getWorldScale(){return this._sharedData.worldScale}getGravityX(){return this._sharedData.gravityX}getGravityY(){return this._sharedData.gravityY}getGravityZ(){return this._sharedData.gravityZ}setGravityX(t){this._sharedData.gravityX!==t&&(this._sharedData.gravityX=t,this._sharedData.physicsSystem.SetGravity(this.getVec3(this._sharedData.gravityX,this._sharedData.gravityY,this._sharedData.gravityZ)))}setGravityY(t){this._sharedData.gravityX!==t&&(this._sharedData.gravityX=t,this._sharedData.physicsSystem.SetGravity(this.getVec3(this._sharedData.gravityX,this._sharedData.gravityY,this._sharedData.gravityZ)))}setGravityZ(t){this._sharedData.gravityX!==t&&(this._sharedData.gravityZ=t,this._sharedData.physicsSystem.SetGravity(this.getVec3(this._sharedData.gravityX,this._sharedData.gravityY,this._sharedData.gravityZ)))}isDynamic(){return this.bodyType==="Dynamic"}isStatic(){return this.bodyType==="Static"}isKinematic(){return this.bodyType==="Kinematic"}isBullet(){return this.bullet}setBullet(t){if(this.bullet===t||(this.bullet=t,this._body===null&&!this._createBody()))return;const e=this._body;this._sharedData.bodyInterface.SetMotionQuality(e.GetID(),this.bullet?Jolt.EMotionQuality_LinearCast:Jolt.EMotionQuality_Discrete)}hasFixedRotation(){return this.fixedRotation}setFixedRotation(t){this.fixedRotation!==t&&(this.fixedRotation=t,this._needToRecreateBody=!0)}getDensity(){return this.density}setDensity(t){t<0&&(t=0),this.density!==t&&(this.density=t,this._needToRecreateShape=!0)}getMassOverride(){return this.massOverride}setMassOverride(t){this.massOverride!==t&&(this.massOverride=t,this._needToRecreateBody=!0)}getShapeOffsetX(){return this.shapeOffsetX}setShapeOffsetX(t){this.shapeOffsetX=t,this._needToRecreateShape=!0}getShapeOffsetY(){return this.shapeOffsetY}setShapeOffsetY(t){this.shapeOffsetY=t,this._needToRecreateShape=!0}getShapeOffsetZ(){return this.shapeOffsetZ}setShapeOffsetZ(t){this.shapeOffsetZ=t,this._needToRecreateShape=!0}getFriction(){return this.friction}setFriction(t){if(t<0&&(t=0),this.friction===t||(this.friction=t,this._body===null&&!this._createBody()))return;const e=this._body;this._sharedData.bodyInterface.SetFriction(e.GetID(),t)}getRestitution(){return this.restitution}setRestitution(t){if(t<0&&(t=0),this.restitution===t||(this.restitution=t,this._body===null&&!this._createBody()))return;const e=this._body;this._sharedData.bodyInterface.SetRestitution(e.GetID(),t)}getLinearDamping(){return this.linearDamping}setLinearDamping(t){if(t<0&&(t=0),this.linearDamping===t||(this.linearDamping=t,this._body===null&&!this._createBody()))return;this._body.GetMotionProperties().SetLinearDamping(t)}getAngularDamping(){return this.angularDamping}setAngularDamping(t){if(t<0&&(t=0),this.angularDamping===t||(this.angularDamping=t,this._body===null&&!this._createBody()))return;this._body.GetMotionProperties().SetAngularDamping(t)}getGravityScale(){return this.gravityScale}setGravityScale(t){if(this.gravityScale===t||(this.gravityScale=t,this._body===null&&!this._createBody()))return;this._body.GetMotionProperties().SetGravityFactor(t)}layerEnabled(t){return t=Math.floor(t),t<1||t>8?!1:!!(this.layers&1<<t-1)}enableLayer(t,e){t=Math.floor(t),!(t<1||t>8)&&(e?this.layers|=1<<t-1:this.layers&=~(1<<t-1),this._needToRecreateBody=!0)}maskEnabled(t){return t=Math.floor(t),t<1||t>16?!1:!!(this.masks&1<<t-1)}enableMask(t,e){t=Math.floor(t),!(t<1||t>16)&&(e?this.masks|=1<<t-1:this.masks&=~(1<<t-1),this._needToRecreateBody=!0)}getLinearVelocityX(){return this._body===null&&!this._createBody()?0:this._body.GetLinearVelocity().GetX()*this._sharedData.worldScale}setLinearVelocityX(t){if(this._body===null&&!this._createBody())return;const e=this._body;this._sharedData.bodyInterface.SetLinearVelocity(e.GetID(),this.getVec3(t*this._sharedData.worldInvScale,e.GetLinearVelocity().GetY(),e.GetLinearVelocity().GetZ()))}getLinearVelocityY(){return this._body===null&&!this._createBody()?0:this._body.GetLinearVelocity().GetY()*this._sharedData.worldScale}setLinearVelocityY(t){if(this._body===null&&!this._createBody())return;const e=this._body;this._sharedData.bodyInterface.SetLinearVelocity(e.GetID(),this.getVec3(e.GetLinearVelocity().GetX(),t*this._sharedData.worldInvScale,e.GetLinearVelocity().GetZ()))}getLinearVelocityZ(){return this._body===null&&!this._createBody()?0:this._body.GetLinearVelocity().GetZ()*this._sharedData.worldScale}setLinearVelocityZ(t){if(this._body===null&&!this._createBody())return;const e=this._body;this._sharedData.bodyInterface.SetLinearVelocity(e.GetID(),this.getVec3(e.GetLinearVelocity().GetX(),e.GetLinearVelocity().GetY(),t*this._sharedData.worldInvScale))}getLinearVelocityLength(){return this._body===null&&!this._createBody()?0:this._body.GetLinearVelocity().Length()*this._sharedData.worldScale}getAngularVelocityX(){if(this._body===null&&!this._createBody())return 0;const t=this._body;return n.toDegrees(t.GetAngularVelocity().GetX())}setAngularVelocityX(t){if(this._body===null&&!this._createBody())return;const e=this._body;this._sharedData.bodyInterface.SetAngularVelocity(e.GetID(),this.getVec3(n.toRad(t),e.GetAngularVelocity().GetY(),e.GetAngularVelocity().GetZ()))}getAngularVelocityY(){if(this._body===null&&!this._createBody())return 0;const t=this._body;return n.toDegrees(t.GetAngularVelocity().GetY())}setAngularVelocityY(t){if(this._body===null&&!this._createBody())return;const e=this._body;this._sharedData.bodyInterface.SetAngularVelocity(e.GetID(),this.getVec3(e.GetAngularVelocity().GetX(),n.toRad(t),e.GetAngularVelocity().GetZ()))}getAngularVelocityZ(){if(this._body===null&&!this._createBody())return 0;const t=this._body;return n.toDegrees(t.GetAngularVelocity().GetZ())}setAngularVelocityZ(t){if(this._body===null&&!this._createBody())return;const e=this._body;this._sharedData.bodyInterface.SetAngularVelocity(e.GetID(),this.getVec3(e.GetAngularVelocity().GetX(),e.GetAngularVelocity().GetY(),n.toRad(t)))}applyForce(t,e,s,i,o,a){if(this._body===null&&!this._createBody())return;const r=this._body;this._sharedData.bodyInterface.AddForce(r.GetID(),this.getVec3(t,e,s),this.getRVec3(i*this._sharedData.worldInvScale,o*this._sharedData.worldInvScale,a*this._sharedData.worldInvScale),Jolt.EActivation_Activate)}applyForceAtCenter(t,e,s){if(this._body===null&&!this._createBody())return;const i=this._body;this._sharedData.bodyInterface.AddForce(i.GetID(),this.getVec3(t,e,s),Jolt.EActivation_Activate)}applyForceTowardPosition(t,e,s,i){if(this._body===null&&!this._createBody())return;const o=this._body,a=e-this.owner3D.getX(),r=s-this.owner3D.getY(),d=i-this.owner3D.getZ(),c=a*a+r*r+d*d;if(c===0)return;const l=t/Math.sqrt(c);this._sharedData.bodyInterface.AddForce(o.GetID(),this.getVec3(a*l,r*l,d*l),Jolt.EActivation_Activate)}applyImpulse(t,e,s,i,o,a){if(this._body===null&&!this._createBody())return;const r=this._body;this._sharedData.bodyInterface.AddImpulse(r.GetID(),this.getVec3(t,e,s),this.getRVec3(i*this._sharedData.worldInvScale,o*this._sharedData.worldInvScale,a*this._sharedData.worldInvScale))}applyImpulseAtCenter(t,e,s){if(this._body===null&&!this._createBody())return;const i=this._body;this._sharedData.bodyInterface.AddImpulse(i.GetID(),this.getVec3(t,e,s))}applyImpulseTowardPosition(t,e,s,i){if(this._body===null&&!this._createBody())return;const o=this._body,a=e-this.owner3D.getX(),r=s-this.owner3D.getY(),d=i-this.owner3D.getZ(),c=a*a+r*r+d*d;if(c===0)return;const l=t/Math.sqrt(c);this._sharedData.bodyInterface.AddImpulse(o.GetID(),this.getVec3(a*l,r*l,d*l))}applyTorque(t,e,s){if(this._body===null&&!this._createBody())return;const i=this._body;this._sharedData.bodyInterface.AddTorque(i.GetID(),this.getVec3(n.toRad(t),n.toRad(e),n.toRad(s)),Jolt.EActivation_Activate)}applyAngularImpulse(t,e,s){if(this._body===null&&!this._createBody())return;const i=this._body;this._sharedData.bodyInterface.AddAngularImpulse(i.GetID(),this.getVec3(n.toRad(t),n.toRad(e),n.toRad(s)))}getMass(){if(this._body===null&&!this._createBody())return 0;const t=this._body;return 1/t.GetMotionProperties().GetInverseMass()}getInertiaAroundX(){if(this._body===null&&!this._createBody())return 0;const t=this._body;return 1/t.GetMotionProperties().GetInverseInertiaDiagonal().GetX()}getInertiaAroundY(){if(this._body===null&&!this._createBody())return 0;const t=this._body;return 1/t.GetMotionProperties().GetInverseInertiaDiagonal().GetY()}getInertiaAroundZ(){if(this._body===null&&!this._createBody())return 0;const t=this._body;return 1/t.GetMotionProperties().GetInverseInertiaDiagonal().GetZ()}getMassCenterX(){return this._body===null&&!this._createBody()?0:this._body.GetCenterOfMassPosition().GetX()*this._sharedData.worldScale}getMassCenterY(){return this._body===null&&!this._createBody()?0:this._body.GetCenterOfMassPosition().GetY()*this._sharedData.worldScale}getMassCenterZ(){return this._body===null&&!this._createBody()?0:this._body.GetCenterOfMassPosition().GetZ()*this._sharedData.worldScale}onContactBegin(t){this._currentContacts.push(t);let e=this._contactsEndedThisFrame.indexOf(t);e!==-1?this._contactsEndedThisFrame.splice(e,1):this._contactsStartedThisFrame.push(t)}onContactEnd(t){this._contactsEndedThisFrame.push(t);const e=this._currentContacts.indexOf(t);e!==-1&&this._currentContacts.splice(e,1)}canCollideAgainst(t){return(this.getMasksAccordingToBodyType()&t.getLayersAccordingToBodyType())!=0}static areObjectsColliding(t,e,s){const i=t.getBehavior(s);return i?i.collisionChecker.isColliding(e):!1}static hasCollisionStartedBetween(t,e,s){const i=t.getBehavior(s);return i?i.collisionChecker.hasCollisionStartedWith(e):!1}static hasCollisionStoppedBetween(t,e,s){const i=t.getBehavior(s);return i?i.collisionChecker.hasCollisionStoppedWith(e):!1}}n.Physics3DRuntimeBehavior=g,n.registerBehavior("Physics3D::Physics3DBehavior",n.Physics3DRuntimeBehavior),function(e){class f{constructor(i){this.behavior=i}createAndAddBody(){const{behavior:i}=this,{_sharedData:o}=i,a=i.createShape(),r=new Jolt.BodyCreationSettings(a,i._getPhysicsPosition(o.getRVec3(0,0,0)),i._getPhysicsRotation(o.getQuat(0,0,0,1)),i.bodyType==="Static"?Jolt.EMotionType_Static:i.bodyType==="Kinematic"?Jolt.EMotionType_Kinematic:Jolt.EMotionType_Dynamic,i.getBodyLayer());r.mMotionQuality=i.bullet?Jolt.EMotionQuality_LinearCast:Jolt.EMotionQuality_Discrete,r.mAllowedDOFs=i.fixedRotation?Jolt.EAllowedDOFs_TranslationX|Jolt.EAllowedDOFs_TranslationY|Jolt.EAllowedDOFs_TranslationZ:Jolt.EAllowedDOFs_All,r.mFriction=i.friction,r.mRestitution=i.restitution,r.mLinearDamping=i.linearDamping,r.mAngularDamping=i.angularDamping,r.mGravityFactor=i.gravityScale,i.massOverride>0&&(r.mOverrideMassProperties=Jolt.EOverrideMassProperties_CalculateInertia,r.mMassPropertiesOverride.mMass=i.massOverride);const d=o.bodyInterface,c=d.CreateBody(r);return Jolt.destroy(r),d.AddBody(c.GetID(),Jolt.EActivation_Activate),c}updateObjectFromBody(){const{behavior:i}=this,{_body:o}=i;o!==null&&o.IsActive()&&(i._moveObjectToPhysicsPosition(o.GetPosition()),i._moveObjectToPhysicsRotation(o.GetRotation()))}updateBodyFromObject(){const{behavior:i}=this,{owner3D:o,_sharedData:a}=i;if(i._body===null&&!i._createBody())return;const r=i._body;(this.behavior._objectOldX!==o.getX()||this.behavior._objectOldY!==o.getY()||this.behavior._objectOldZ!==o.getZ()||this.behavior._objectOldRotationX!==o.getRotationX()||this.behavior._objectOldRotationY!==o.getRotationY()||this.behavior._objectOldRotationZ!==o.getAngle())&&a.bodyInterface.SetPositionAndRotationWhenChanged(r.GetID(),this.behavior._getPhysicsPosition(a.getRVec3(0,0,0)),this.behavior._getPhysicsRotation(a.getQuat(0,0,0,1)),Jolt.EActivation_Activate)}recreateShape(){const{behavior:i}=this,{_sharedData:o}=i;if(i._body===null&&!i._createBody())return;const a=i._body;o.bodyInterface.SetShape(a.GetID(),i.createShape(),!0,Jolt.EActivation_Activate)}destroyBody(){const{behavior:i}=this,{_sharedData:o}=i;i._body!==null&&(o.bodyInterface.RemoveBody(i._body.GetID()),o.bodyInterface.DestroyBody(i._body.GetID()),i._body=null)}}e.DefaultBodyUpdater=f;class t{constructor(i){this.behavior=i}isColliding(i){return this.behavior._currentContacts.some(o=>o.owner===i)?!0:this.behavior._contactsStartedThisFrame.some(o=>o.owner===i)}hasCollisionStartedWith(i){return this.behavior._contactsStartedThisFrame.some(o=>o.owner===i)}hasCollisionStoppedWith(i){return this.behavior._contactsEndedThisFrame.some(o=>o.owner===i)}}e.DefaultCollisionChecker=t}(g=n.Physics3DRuntimeBehavior||(n.Physics3DRuntimeBehavior={}))})(gdjs||(gdjs={}));
//# sourceMappingURL=Physics3DRuntimeBehavior.js.map
